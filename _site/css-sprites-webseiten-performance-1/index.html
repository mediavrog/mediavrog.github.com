<p>layout: post
title: ‘CSS Sprites - Webseiten Performance 1’
published: true
author: mediavrog
comments: true
date: 2010-02-16 12:02:06
tags:
    - animation
    - clipping
    - performance
    - sprites
    - yslow
categories:
    - css
permalink: /2010/02/16/css/css-sprites-webseiten-performance-1
image:
    thumb: thumb.png
—
&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</p>

<h2 id="was-sind-css-sprites">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools">Relevante Tools</h3>

<ul>
  <li>[&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</li>
</ul>

<h2 id="was-sind-css-sprites-1">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-1">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-1">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-1">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-1">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-1">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-1">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-1">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-1">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-1">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-1">Relevante Tools</h3>

<p>*]<a href="http://spriteme.org">10</a> – halbautomatisierte Spriteerstellung
  * [&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</p>

<h2 id="was-sind-css-sprites-2">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-2">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-2">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-2">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-2">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-2">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-2">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-2">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-2">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-2">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-2">Relevante Tools</h3>

<ul>
  <li>[&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</li>
</ul>

<h2 id="was-sind-css-sprites-3">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-3">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-3">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-3">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-3">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-3">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-3">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-3">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-3">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-3">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-3">Relevante Tools</h3>

<p>*]<a href="http://spriteme.org">10</a> – halbautomatisierte Spriteerstellung
  *]<a href="http://developer.yahoo.com/yslow/">11</a> – Analyse der Seitenperformance
  * [&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</p>

<h2 id="was-sind-css-sprites-4">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-4">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-4">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-4">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-4">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-4">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-4">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-4">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-4">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-4">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-4">Relevante Tools</h3>

<ul>
  <li>[&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</li>
</ul>

<h2 id="was-sind-css-sprites-5">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-5">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-5">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-5">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-5">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-5">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-5">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-5">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-5">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-5">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-5">Relevante Tools</h3>

<p>*]<a href="http://spriteme.org">10</a> – halbautomatisierte Spriteerstellung
  * [&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</p>

<h2 id="was-sind-css-sprites-6">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-6">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-6">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-6">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-6">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-6">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-6">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-6">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-6">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-6">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-6">Relevante Tools</h3>

<ul>
  <li>[&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</li>
</ul>

<h2 id="was-sind-css-sprites-7">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-7">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-7">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-7">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-7">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-7">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-7">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-7">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-7">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-7">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-7">Relevante Tools</h3>

<p>*]<a href="http://spriteme.org">10</a> – halbautomatisierte Spriteerstellung
  *]<a href="http://developer.yahoo.com/yslow/">11</a> – Analyse der Seitenperformance
  *]<a href="https://addons.mozilla.org/de/firefox/addon/1843">12</a> / Web Developer Tools /Opera DragonFly / … (je nach Browser) – Analyse der Ladezeiten aller Webseitenelemente
  * [&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</p>

<h2 id="was-sind-css-sprites-8">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-8">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-8">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-8">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-8">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-8">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-8">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-8">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-8">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-8">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-8">Relevante Tools</h3>

<ul>
  <li>[&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</li>
</ul>

<h2 id="was-sind-css-sprites-9">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-9">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-9">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-9">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-9">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-9">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-9">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-9">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-9">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-9">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-9">Relevante Tools</h3>

<p>*]<a href="http://spriteme.org">10</a> – halbautomatisierte Spriteerstellung
  * [&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</p>

<h2 id="was-sind-css-sprites-10">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-10">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-10">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-10">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-10">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-10">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-10">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-10">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-10">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-10">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-10">Relevante Tools</h3>

<ul>
  <li>[&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</li>
</ul>

<h2 id="was-sind-css-sprites-11">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-11">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-11">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-11">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-11">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-11">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-11">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-11">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-11">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-11">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-11">Relevante Tools</h3>

<p>*]<a href="http://spriteme.org">10</a> – halbautomatisierte Spriteerstellung
  *]<a href="http://developer.yahoo.com/yslow/">11</a> – Analyse der Seitenperformance
  * [&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</p>

<h2 id="was-sind-css-sprites-12">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-12">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-12">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-12">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-12">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-12">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-12">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-12">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-12">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-12">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-12">Relevante Tools</h3>

<ul>
  <li>[&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</li>
</ul>

<h2 id="was-sind-css-sprites-13">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-13">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-13">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-13">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-13">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-13">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-13">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-13">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-13">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-13">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-13">Relevante Tools</h3>

<p>*]<a href="http://spriteme.org">10</a> – halbautomatisierte Spriteerstellung
  * [&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</p>

<h2 id="was-sind-css-sprites-14">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-14">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-14">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-14">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-14">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-14">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-14">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-14">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-14">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-14">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-14">Relevante Tools</h3>

<ul>
  <li>[&gt; CSS Sprites sind ein sehr gutes Mittel zur Verringerung der Ladezeiten von Webseiten. Dennoch scheuen viele Entwickler noch den Einsatz von CSS Sprites, da fehlende Erfahrung beim Erstellen viel Zeit kosten und den Performancegewinn zunichte machen kann. In diesem Artikel möchte ich gängige Verfahren und Ansätze darstellen, um übliche Fehler zu vermeiden. Ich möchte dem Leser damit die Fähigkeit vermitteln, die richtigen Entscheidungen zum Einsatz von CSS Sprites treffen zu können.</li>
</ul>

<h2 id="was-sind-css-sprites-15">Was sind CSS Sprites?</h2>

<p>Eine knappe Einführung noch vorweg, für alle die mit dem Begriff per se (noch) nichts anfangen können:</p>

<p>Sprites sind (Bild-)Dateien, in denen viele Bilder nebeneinander angeordnet sind. Bei der Darstellung eines Sprite wird aber immer nur ein Ausschnitt gezeigt, während die anderen Bilder verborgen bleiben (<em>maskiert</em>). Beim Verschieben der Grafik im Hintergrund wird ein weiterer Teil sichtbar. Animiert man die Position des Hintergrundbildes, kann so der Eindruck von Bewegung entstehen. Diese Technik entstammt der Computerspielindustrie, wo sie bereits seit Jahrzehnten eingesetzt wird. <a href="http://de.wikipedia.org/wiki/Sprite_%28Computergrafik%29">Genaueres zu Sprites im Allgemeinen findet sich in der Wikipedia.</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code>Kirby Idle Animation by hextupleyoodot - Thanks
  



  
  
  
Die Einzelbilder der Kirby Idle Animation by hextupleyoodot
</code></pre>
</div>

<p>(thanks to <a href="http://hextupleyoodot.deviantart.com/">hextupleyoodot</a>)</p>

<p><strong>CSS Sprites</strong> nutzen ebenfalls eine Bilddatei, in der mehrere Einzelbilder enthalten sind, aber meist nicht zum Zwecke der Animation. Vielmehr werden sie als Hintergrundbild vieler Elemente referenziert, wobei durch Angabe der Position das gewünschte Bild dargestellt wird.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprites kommen vor allem für kleinere Grafiken und Hintergrundgrafiken zum Einsatz, welche auf einer Webseite zur Gestaltung eingesetzt werden. Diese Technik eignet sich für Designelemente und nicht für inhaltsbezogene Bilder wie Fotos.
</code></pre>
</div>

<h3 id="wie-funktionieren-css-sprites-genau-15">Wie funktionieren CSS Sprites genau?</h3>

<p>Das folgende <strong>Beispielbild</strong> enthält mehrere Zustände einer Auswahlbox. Anstatt per :hover, :focus etc. die Bilder auszutauschen, habe ich sie in ein Bild gepackt (» CSS Sprite). Sie sollen nun als Hintergrundbilder eines HTML-Elements zum Einsatz kommen. Mittels CSS wird dabe das Sprite als background-image zugewiesen. Der Trick besteht nun darin, für jeden Status des Elements die passende background-position zu definieren. Damit wird das Sprite unter dem Element so positioniert, dass die gewünschte Teilgrafik sichtbar wird.</p>

<h4 id="beispiel-fr-die-verwendung-von-css-sprites-15">Beispiel für die Verwendung von CSS Sprites</h4>

<h4 id="das-passende-css-15">Das passende CSS</h4>

<p>.checkbox{
  background: url(checkboxes.png) no-repeat 0 0;
  height: 25px;
  width: 25px;
}</p>

<p>.checkbox.checked{
  background-position: 0 -40px;
}</p>

<p>.checkbox:focus{
  background-position: 0 -80px;
}</p>

<p>[…]</p>

<p><a href="http://customformelements.net/demopage.php#c1">Demo (customformelements.net)</a>{.button}</p>

<hr />

<p><strong>Auf der nächste Seite werden Vor- und Nachteile für den Einsatz von CSS Sprites dargestellt.</strong></p>

<h2 id="warum-css-sprites-15">Warum CSS Sprites?</h2>

<p>Die Vorteile, mehrere Grafikressourcen in einer zusammenzustellen, lassen sich wie folgt zusammenfassen:</p>

<dl>
  <dt>weniger HttpRequests</dt>
  <dd>Beim Herunterladen und Parsen einer Seite suchen Clients (Browser) u.A. alle extern referenzierten Ressourcen zusammen und laden sie. Dazu werden die benötigten HttpRequests oftmals parallelisiert (meist 2 bis 4 Requests gleichzeitig), um den Seitenaufbau zu beschleunigen. Jeder Verbindungsaufbau bringt aber eine gewisse Latenz und Overhead mit sich (Header-Daten/..). Zudem können sie bei voller Auslastung der Queue den Seitenaufbau blockieren. Durch das Zusammenführen vieler Bilder in eine Datei verbessert sich das Verhältnis zwischen Nutzdaten und Metadaten, und Latenzen durch viele HttpRequests werden vermieden (da nur noch ein Request für eine Menge von Bildern benötigt wird).</dd>
  <dt>bessere Kompressionsrate</dt>
  <dd>Weiterhin kann die Gesamtdateigröße eines Sprites im Vergleich zu den einzelnen Bildern sinken, da Metadaten (Grafk Headerinformationen) nur noch einmal vorhanden sind und Kompressionsalgorithmen alle Bilder mitverarbeiten. Dies gilt vor allem für Sprites, bei denen die Einzelbilder in einem möglichst kleinen Abstand zum Nächsten angeordnet sind. CSS Sprites sind aber auch durch Leerräume gekenzeichnet, welche die Dateigröße erhöhen können.</dd>
</dl>

<h2 id="nachteile--kontraindikationen-15">Nachteile / Kontraindikationen</h2>

<dl>
  <dt>primär anwendbar für Hintergrundgrafken</dt>
  <dd>CSS Sprites sind vor Allem für die Verwendung als Hintergrundgrafk geeignet, da sich die Positionierung mittels CSS einfach realisieren lässt. Theoretisch wäre auch eine Lösung per img-Tag in Verbindung mit der CSS Eigenschaft clip denkbar; diese Variante ist aber bei vielen Bildern nicht praktikabel.</dd>
  <dt>Bedingt geeignet für sich wiederholende Hintergrundbilder</dt>
  <dd>Da in CSS Sprites (je nach Aufbau) viele Einzelbilder nebeneinander und/oder übereinander befinden und das Sprite eine gewisse Breite besitzt, lassen sich wiederholende Hintergrundbilder (repeat-y / repeat-x und Einzelbilder nicht praktikabel in <strong>einem einzelnen</strong> Sprite kombinieren.</dd>
  <dt>evtl. hoher Arbeitsspeicherbedarf</dt>
  <dd>Obwohl das Bild komprimiert gespeichert wird, kann der Client natürlich nicht komprimiert darstellen. Er lädt das Bild Pixel für Pixel in den Arbeitsspeicher, was bei großen, schlecht optimierten Sprites schnell viele MB belegen kann. Größenordnungen von 50 MB sind dabei keine Seltenheit – So nimmt ein 1000 x 10.000 Pixel großes Bild mit Alphakanal bereits um die 40 MB Arbeitsspeicher ein.</dd>
</dl>

<hr />

<p><strong>Auf der nächste Seite wird erklärt, wie CSS Sprites erstellt und eingesetzt werden und wie den erwähnten Nachteilen entgegnet werden kann.</strong></p>

<h2 id="erstellen-von-sprites-15">Erstellen von Sprites</h2>

<p>Sprites können halbautomatisiert oder manuell erstellt werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Als Faustregel für die ersten Projekte mit dem Einsatz von CSS Sprites gilt: Setze das Design ersteinmal OHNE Sprites in (X)HTML/CSS um. Danach lassen sich die benötigten Elemente für ein Sprite leichter identifizieren und in einer Grafik setzen. Dieser Ansatz spart Entwicklungszeit, da sich vorerst nicht um die Positionierung des Sprites gesorgt werden muss und gleichfalls im Prozess anfallende grafische Änderungen schneller umgesetzt werden können. Auch für Fortgeschrittene kann dieser Weg aufgrund der angesprochenen Zeitersparnis und erhöhter Flexibilität geeignet sein.
</code></pre>
</div>

<h3 id="halbautomatisierte-erstellung-15">halbautomatisierte Erstellung</h3>

<p>Für die halbautomatisierte Erstellung von CSS Sprites existieren verschiedene Tools. Ein Vertreter ist das Bookmarklet von <a href="http://spriteme.org/">SpriteMe,</a> welches vor allem für Einsteiger hilfreich sein oder schnelle Optimierungen ermöglichen soll. Es hilft beim Identifizieren von verwendeten Hintergrundbildern einer Seite und der Erstellung von Sprite und CSS. Dabei werden wie oben erwähnt, sich wiederholende Hintergrundbilder ausgeschlossen. (Details zu SpriteMe sind auf  nachzulesen).</p>

<p>Soweit ganz praktisch,.. Doch leider zeigt sich schnell, dass ohne manuelles Eingreifen kein gutes Ergebnis erzielt werden kann. Ich habe mit SpriteMe zum Beispiel ein CSS Sprite meines Blogs erstellt (vorher ohne Sprite). Das Ergebnis war erschreckend: Extrem viel ungenutzter Platz sorgte für einen Anstieg der Bildgröße um 60 KB:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Ergebnis-Sprite für mediavrog.net/blog
</code></pre>
</div>

<p>Dieses Resultat ist meines Erachtens nicht zufriedenstellend, da extrem viel Platz vergeudet wird. Es zeigt damit sehr gut die Grenzen der Automation bei CSS Sprites. Auch die automatische Erstellung des zugehörigen CSS wiegt in diesem Fall den Nachteil eines viel zu großen Bildes nicht auf. Weiterhin erkennt SpriteMe auch nicht automatisch, welche img-Tags eventuell noch zur Verwendung mit einem CSS Sprite umgearbeitet werden könnten (Grafik als Hintergrundbild,…).</p>

<h3 id="manuelle-erstellung-15">manuelle Erstellung</h3>

<p>Für feinsinnige Optimierungen empfehle ich daher die manuelle Erstellung von CSS Sprites. Auch wenn dies initial mit etwas mehr Aufwand verbunden ist, kann man mit vorausschauendem Vorgehen die Vorteile von CSS Sprites hervorkehren und die Nachteile weitestgehend unterdrücken.</p>

<p>Die wichtigsten Punkte beim manuellen Setzen der Sprites sind:</p>

<ul>
  <li><a href="#selection">Wahl der Bilder für das Sprite</a></li>
  <li><a href="#dimensions">Festlegen von passenden Bilddimensionen</a></li>
  <li><a href="#grid">Wahl eines geeigneten Rasters</a></li>
  <li><a href="#positioning">Positionierung der Bilder</a></li>
</ul>

<h4 id="selection">Wahl der Bilder für das Sprite</h4>

<p>Ein einfacher aber wichtiger Schritt besteht in der Auswahl der Bilder, welche mit Sprites eingebunden werden sollen. Erfüllt ein Bild den Großteil der folgenden <strong>Kriterien</strong>, so ist es sehr wahrscheinlich für den Einsatz in einem Sprite geeignet:</p>

<ul>
  <li>Ist das Bild ein Icon oder Logo?</li>
  <li>Dient das Bild hauptsächlich der Gestaltung von Elementen?</li>
  <li>Ist das Bild bereits als Hintergrund für ein Element definiert?</li>
  <li>Wiederholt sich das Bild an verschiedenen Stellen der Webseite?</li>
  <li>Ist das Bild kein Foto?</li>
</ul>

<p>Die so herausgefilterten Bilder werden nun in <strong>3 Gruppen</strong> geteilt:</p>

<ol>
  <li><strong>Einzelbilder</strong></li>
  <li>Hintergrundbilder, welche sich auf der <strong>x-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Höhe</strong> hat</li>
  <li>Hintergrundbilder, welche sich auf der <strong>y-Achse</strong> wiederholen und deren umgebendes Element eine <strong>feste Breite</strong> hat</li>
</ol>

<p>Bilder, welche in keine der genannten Gruppen passen, werden nun aussortiert und können nicht für in Sprites verwendet werden. Für jede Gruppe, welche mindestens 2 Bilder enthält, kann ein Sprite erstellt werden.</p>

<p>Im Falle der sich <strong>wiederholenden Hintergrundbilder</strong> wird nun ein Sprite mit einer Breite (repeat auf der x-Achse) bzw. Höhe (repeat auf der y-Achse) von <strong>1 Px</strong> erstellt. Die Bilder werden untereinander bzw. nebeneinander angeordnet. In den meisten Fällen ist dies ausreichend und es muss nur noch ein <a href="#grid">geeignetes (vertikales) Raster</a> gefunden werden. Für <strong>Einzelbildsprites ist der folgende Punkt zusätzlich</strong> wichtig.</p>

<h4 id="dimensions">Festlegen von passenden Bilddimensionen für Einzelbildersprites</h4>

<p>Die richtige Wahl der Bilddimensionen ist entscheidend für die Erweiterbarkeit Effektivität des CSS Sprites. Das grundlegende <strong>Format ist meist vertikal angelegt</strong> (= Höhe variabel, Breite fix), was wohl in der einfacheren Bearbeitung des Bildes fußt (horizontal zu Scrollen und dabei ein Bild zu bearbeiten ist eben ungewohnt :) ).</p>

<p>Nun gilt es noch die <strong>passende Breite</strong> zu bestimmen. Sie sollte dabei je nach Anforderungen / Aufbau der Webseite mindestens so breit sein wie:</p>

<ul>
  <li><strong>die Breite der Webseite</strong> bei fixed width Layouts, falls Hintergrundbilder über die gesamte Breite einmal benötigt werden sollten</li>
  <li>die Breite des breitesten Bildes</li>
</ul>

<p>Eventuell wird später nach rechts noch etwas Freiraum angehangen, je nachdem welches <a href="#grid">Raster</a> im nächsten Schritt gewählt wird.</p>

<h4 id="grid">Wahl eines geeigneten Rasters</h4>

<p>Nun kommt der wichtigste Teil: für alle Bilder des Sprites muss ein passendes Raster gefunden werden.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Das Raster ist ein Hilfsmittel zur leichteren Positionierung von Elementen mittels CSS. Theoretisch können die Bilder auch ohne Raster dicht an dicht gepackt werden, was die Pflege und Erweiterbarkeit des Sprites aber einschränkt.
</code></pre>
</div>

<p>Aus Erfahrung empfehle ich:</p>

<ul>
  <li>zuerst das kleinste Bild heraussuchen</li>
  <li>a) ist es als Hintergrundbild eines Elementes eingebettet, so nimm die Abmessungen dieses Elements und runde sie auf die nächsthöhere durch 10 teilbare Zahl</li>
  <li>b) runde ansonsten die Abmessungen des Bildes wie beschrieben auf</li>
</ul>

<p>Beispiel: Es soll ein 16x16px großes Icon (das kleinste aller Bilder) in einem Sprite eingebettet werden. Es ist Hintergrundbild eines 18×18 großen div’s. Das Grundraster für das Sprite wäre denmach 20 x 20 Pixel.</p>

<h4 id="positioning">Positionierung der Bilder</h4>

<p>Die Bilder werden nun so im Sprite verteilt, dass ein Bild immer an einem Vielfachen des Grundrasters ausgerichtet wird. Bilder, deren umgebendes HTML Element eine variable Breite oder Höhe hat, müssen dabei mit ausreichend Platz positioniert werden. Ist z.B. die Breite nicht fix, so muss das Bild eventuell in eine eigene Zeile gesetzt werden.</p>

<p>Diese Herangehensweise ermöglicht auch die kleinsten Bilder ohne viel Platzverschwendung in einem Sprite unterzubekommen. Weiterhin lässt sich beim Positionieren mittels CSS sehr einfach und schnell mit durch 10 teilbaren Zahlen rechnen. Ich habe das zuvor von SpriteMe erstellte Sprite nach den genannten Regeln manuell bearbeitet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CSS Sprite für mediavrog.net/blog - manuell gesetzt
  



  
Das breite grüne Hintergrundbild habe ich bewusst entfernt, da es die Datei unnötig aufgebläht hat. Beide Grafiken zusammen sind nun bereits 20 kB kleiner als das von SpriteMe erzeugt CSS Sprite.
  
  
  
Das Setzen der Grafiken erfordert etwas Erfahrung, bis die Verteilung gut gelöst werden kann. Kleine Tipps dazu:
  
  
  

  ähnliche Bilder in unmittelbarer Nähe positionieren und noch etwas Freiraum lassen, falls weitere Bilder dieses Typs hinzukommen (z.B. Icons)


  Platz nach rechts bzw. links bei Hintergrundbildern für Elemente mit flexibler Breite lassen


  Bilder möglichst dicht, dennoch mit etwas Abstand zueinander setzen


  Bilder, die viel/unbestimmten Platz nach rechts brauchen, am rechten Rand positionieren; entsprechend für Platz nach links

  
  
  
Vergleich der beiden Ansätze
  
  
  
Vor- und Nachteile von automatisiertem und manuellem Erstellen von Sprites 
  
  
  
  
    SpriteMe (halbautomatisch)
  
  
  
    Grafik setzen (manuell)
  



  
    Vorteile
  
  
  
    
      
        schnelle Erstellung von Sprites UND CSS
      
      
        keine Grafikbearbeitung nötig
      
    
  
  
  
    
      
        bessereVerteilung der Bilder
      
      
        kleinere Dateigrößen
      
      
        Positionierung mit Hinblick auf Erweiterungen
      
    
  



  
    Nachteile
  
  
  
    
      
        keine Möglichkeit zur Optimierung
      
      
        keine Verarbeitung von repeat-y / repeat-x Bildern möglich
      
      
        schlechte Wartbarkeit durch flexible Höhe
      
    
  
  
  
    
      
        zeitaufwendig
      
      
        Bildbearbeitungsprogramm wird benötigt
      
    
  

  
  
  

  
    Hintergrundbilder, welche sich auf der x-Achse wiederholen
</code></pre>
</div>

<p>Zusammenfassung und Tools gibts auf der letzten Seite.</p>

<h2 id="zusammenfassung-15">Zusammenfassung</h2>

<p>CSS Sprites können helfen, den Seitenaufbau zu beschleunigen. Durch die verminderte Anzahl von Requests werden sowohl Client als auch Server etwas entlastet. Der schnellere Seitenaufbau und die geringeren Übertragungsvolumen steigern die User Experience. Dies wird auch und vor Allem bei mouseover- und focus-Effekten deutlich: da alle Stati bereits im Sprite enthalten sind, kommt es nicht zu den typischen Nachladeverzögerungen.</p>

<p>Die Erstellung der Sprites kostet dafür etwas mehr Zeit und es können meist nicht alle Grafiken in Sprites verarbeitet werden. Auch die etwas umständliche Positionierung mittels CSS erfordert initial etwas mehr Zeit aber die Nutzer werden ein schnelleres Interface und (gefühlt) verkürzte Ladezeiten schätzen :)</p>

<p>Zu guter Letzt setzen auch viele große Firmen auf CSS Sprites. <a href="http://www.smashingmagazine.com/2009/04/27/the-mystery-of-css-sprites-techniques-tools-and-tutorials/">Beispiele dafür gibts beim SmashingMagazine</a>.</p>

<h3 id="relevante-tools-15">Relevante Tools</h3>

<p>*]<a href="http://spriteme.org">10</a> – halbautomatisierte Spriteerstellung
  *]<a href="http://developer.yahoo.com/yslow/">11</a> – Analyse der Seitenperformance
  *]<a href="https://addons.mozilla.org/de/firefox/addon/1843">12</a> / Web Developer Tools /Opera DragonFly / … (je nach Browser) – Analyse der Ladezeiten aller Webseitenelemente
  *]<a href="http://developer.yahoo.com/yui/compressor/">13</a> – für noch mehr Performance komprimiert der YUICompressor eure CSS und Javascript-Dateien.</p>

<p><strong>Welche Erfahrungen habt ihr im Umgang mit CSS Sprites? Setzt ihr sie in euren Projekten ein? Zeigt eure Sprites und diskutiert mit mir.</strong></p>

